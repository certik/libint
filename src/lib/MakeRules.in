
HAVE_MAKERULES = yes

.PHONY: default install install_inc install_target uninstall clean oclean distclean targetclean realclean rm_libsrcdir

default:: $(TOPDIR)/lib/$(TARGET)

$(TOPDIR)/lib/$(TARGET): source
	cd $(LIBSRCLINK); $(MAKE) TO_TOPDIR=$(TO_TOPDIR) TOPDIR=$(TOPOBJDIR) SRCDIR=$(SRCDIR)

install:: install_inc install_target

install_inc:: $(TOPDIR)/lib/$(TARGET)
	$(INSTALL) $(INSTALLDIROPT) $(DESTDIR)$(includedir)/$(NAME)
	for inc in $(INC); \
	do \
	  $(INSTALL) $(INSTALLLIBOPT) $(TOPDIR)/include/$(NAME)/$${inc} $(DESTDIR)$(includedir)/$(NAME); \
	done

install_target:: $(TOPDIR)/lib/$(TARGET)
	$(INSTALL) $(INSTALLDIROPT) $(DESTDIR)$(libdir)
	$(LTINST) $(INSTALL) $(INSTALLLIBOPT) $< $(DESTDIR)$(libdir)

uninstall::
	-rm -f $(DESTDIR)$(libdir)/$(TARGET)
	for inc in $(INC); \
	do \
	  rm -f $(DESTDIR)$(includedir)/$(NAME)/$${inc}; \
	done
	-rm -rf $(DESTDIR)$(includedir)/$(NAME)

clean:
	if test -f source; then \
cd $(LIBSRCLINK); $(MAKE) TO_TOPDIR=$(TO_TOPDIR) TOPDIR=$(TOPOBJDIR) SRCDIR=$(SRCDIR) clean; \
fi

oclean:
	if test -f source; then \
cd $(LIBSRCLINK); $(MAKE) TO_TOPDIR=$(TO_TOPDIR) TOPDIR=$(TOPOBJDIR) SRCDIR=$(SRCDIR) oclean; \
fi

distclean:
	if test -f source; then \
cd $(LIBSRCLINK); $(MAKE) TO_TOPDIR=$(TO_TOPDIR) TOPDIR=$(TOPOBJDIR) SRCDIR=$(SRCDIR) distclean; \
fi
	$(MAKE) realclean

targetclean:
	if test -f source; then \
cd $(LIBSRCLINK); $(MAKE) TO_TOPDIR=$(TO_TOPDIR) TOPDIR=$(TOPOBJDIR) SRCDIR=$(SRCDIR) targetclean; \
fi

realclean: rm_libsrcdir

rm_libsrcdir:
	-rm -rf $(LIBSRCDIR)
	-rm -f $(LIBSRCLINK)
	-rm -f source
	-rm -f make_libsrcdir

source: make_libsrcdir $(LIBSRCDIR)/Makefile $(LIBSRCDIR)/$(NAME).h
	echo "Last time library source was generated:\c" > $@
	date >> $@

make_libsrcdir:
	if test -f "$@"; then \
$(MAKE) rm_libsrcdir; \
fi; \
$(INSTALL) $(INSTALLDIROPT) $(LIBSRCDIR) || exit 1; \
$(LN_S) $(LIBSRCDIR) $(LIBSRCLINK) || exit 1; \
	echo "Last time the library source directory was created:\c" > $@
	date >> $@

$(LIBSRCDIR)/Makefile: make_libsrcdir $(SRCDIR)/Makefile.library
	cp -f $(SRCDIR)/Makefile.library $@

$(LIBSRCDIR)/$(NAME).h: $(TOPOBJDIR)/src/bin/$(NAME)/$(COMPILER) $(LIBSRCDIR)/Makefile
	cd $(LIBSRCLINK); $(TOPOBJDIR)/src/bin/$(NAME)/$(COMPILER)

